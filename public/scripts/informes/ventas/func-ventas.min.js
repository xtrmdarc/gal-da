$(function(){moment.locale("es"),listar()}),$("#start, #end, #tipo_doc, #cod_cajas").change(function(){listar()});var listar=function(){ifecha=$("#start").val(),ffecha=$("#end").val(),tdoc=$("#tipo_doc").selectpicker("val"),icaja=$("#cod_cajas").selectpicker("val");var t=0,a=0;$.ajax({type:"POST",url:"?c=Informe&a=Datos",data:{ifecha:ifecha,ffecha:ffecha,tdoc:tdoc,icaja:icaja},dataType:"json",success:function(e){0!=e.data.length&&$.each(e.data,function(e,r){t+=parseFloat(r.total),a=r.igv});var r=parseFloat(t)*parseFloat(a),n=parseFloat(t)-parseFloat(r);$("#total_v").text("S/ "+t.toFixed(2)),$("#subt_v").text("S/ "+n.toFixed(2)),$("#igv_v").text("S/ "+r.toFixed(2))}});$("#table").DataTable({destroy:!0,responsive:!0,dom:"tp",bSort:!1,ajax:{method:"POST",url:"?c=Informe&a=Datos",data:{ifecha:ifecha,ffecha:ffecha,tdoc:tdoc,icaja:icaja}},columns:[{data:"fecha_venta",render:function(t,a,e){return'<i class="fa fa-calendar"></i> '+moment(t).format("DD-MM-Y")+'<br><i class="fa fa-clock-o"></i> '+moment(t).format("h:mm A")}},{data:"desc_caja",render:function(t,a,e){return'<p class="mayus">'+t+"</p>"}},{data:"Cliente.nombre",render:function(t,a,e){return'<p class="mayus">'+t+"</p>"}},{data:null,render:function(t,a,e){return t.desc_td+"<br>"+t.numero}},{data:null,render:function(t,a,e){var r=t.id_tipo_pago;switch(r){case"1":return'<p class="text-right"><strong>Efectivo(S/):</strong> '+t.pago_efe+"</p>";case"2":return'<p class="text-right"><strong>Tarjeta(S/):</strong> '+t.pago_tar+"</p>";case"3":return'<p class="text-right"><strong>Efectivo(S/):</strong> '+t.pago_efe+"<br><strong>Tarjeta(S/):</strong> "+t.pago_tar+"</p>"}}},{data:null,render:function(t,a,e){switch(!0){case t.descuento>0:return'<div class="text-right bold">S/ '+t.total+'</div><p class="text-right">Dscto.: -'+t.descuento+"</p>";default:return'<p class="text-right bold">S/ '+t.total+"</p>"}}},{data:null,render:function(t,a,e){return"Contado"}},{data:"creator",render:function(t,a,e){return'<p class="text-center"><span class="label label-primary">ACTIVO</span></p>'}},{data:null,render:function(t,a,e){return'<p class="text-center"><a class="btn btn-sm btn-primary" onclick="detalle('+t.id_pedido+",'"+t.desc_td+"','"+t.numero+"')\">Ver</a></p>"}}]})},detalle=function(t,a,e){$("#lista_p").empty(),$("#detalle").modal("show"),$(".title-d").text(a+" - "+e),$.ajax({type:"post",dataType:"json",data:{cod:t},url:"?c=Informe&a=Detalle",success:function(t){$.each(t,function(t,a){var e=a.precio*a.cantidad;$("#lista_p").append($("<tr/>").append($("<td/>").html(a.cantidad)).append($("<td/>").html(a.Producto.nombre_prod+' <span class="label label-primary">'+a.Producto.pres_prod+"</span>")).append($("<td/>").html("S/ "+a.precio)).append($('<td class="text-right"/>').html("S/ "+e.toFixed(2))))})}})};